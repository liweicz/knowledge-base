name: Auto Update CHANGELOG

on:
  push:
    branches: [ "main" ]

permissions:
  contents: write

jobs:
  changelog:
    # é¿å…æœºå™¨äººè‡ªå·±çš„æäº¤å†æ¬¡è§¦å‘ï¼ˆæ­»å¾ªçŽ¯ï¼‰
    if: github.actor != 'github-actions[bot]'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Append to CHANGELOG
        run: |
          mkdir -p "90_æ›´æ–°æ—¥å¿—"
          touch "90_æ›´æ–°æ—¥å¿—/CHANGELOG.md"

          DATE=$(date -u +"%Y-%m-%d %H:%M UTC")
          COMMIT=$(git log -1 --pretty=format:"%h - %s")
          FILES=$(git diff --name-only HEAD~1 HEAD | sed 's/^/- /')

          {
            echo ""
            echo "## ${DATE}"
            echo ""
            echo "**${COMMIT}**"
            echo ""
            echo "${FILES}"
          } >> "90_æ›´æ–°æ—¥å¿—/CHANGELOG.md"

      - name: Commit changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add "90_æ›´æ–°æ—¥å¿—/CHANGELOG.md"
          git commit -m "ðŸ¤– è‡ªåŠ¨æ›´æ–°æ›´æ–°æ—¥å¿—" || exit 0
          git push
